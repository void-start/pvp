<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PvP Arena</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@telegram-web-app/sdk@1.0.0-alpha.3/dist/telegram-web-app.js"></script>
</head>
<body>

<!-- Экран авторизации -->
<div id="auth-screen" style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
    <button id="auth-btn">Авторизоваться через Telegram</button>
</div>

<!-- Экран игры -->
<div id="game-screen" style="display: none;">
    <!-- Игровой интерфейс здесь -->
</div>

<script>
    window.addEventListener("load", () => {
        if (window.Telegram.WebApp) {
            // Инициализация WebApp
            Telegram.WebApp.expand();
            Telegram.WebApp.ready();
        }

        const authBtn = document.getElementById("auth-btn");

        authBtn.addEventListener("click", () => {
            const user = Telegram.WebApp.initDataUnsafe.user;
            const data = {
                id: user.id,
                username: user.username,
                first_name: user.first_name,
                last_name: user.last_name,
                auth_date: Telegram.WebApp.initDataUnsafe.auth_date,
                hash: Telegram.WebApp.initDataUnsafe.hash
            };

            // Отправляем данные на сервер
            fetch('auth.php', {
                method: 'POST',
                body: JSON.stringify({ data: JSON.stringify(data) })
            })
            .then(response => response.json())
            .then(responseData => {
                if (responseData.status === 'user_exists') {
                    // Если пользователь существует, переключаемся на игровую сцену
                    document.getElementById('auth-screen').style.display = 'none';
                    document.getElementById('game-screen').style.display = 'block';
                } else if (responseData.status === 'new_user') {
                    // Нового пользователя добавляем и показываем игру
                    document.getElementById('auth-screen').style.display = 'none';
                    document.getElementById('game-screen').style.display = 'block';
                }
            })
            .catch(error => {
                console.error("Ошибка авторизации", error);
            });
        });
    });
</script>

</body>
</html>
